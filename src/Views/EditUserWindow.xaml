<Window x:Class="FaceRecognitionAttendance.Views.EditUserWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:ui="http://schemas.modernwpf.com/2019"
        xmlns:converters="clr-namespace:FaceRecognitionAttendance.Converters"
        ui:WindowHelper.UseModernWindowStyle="True"
        Title="Edit User Information" 
        Height="750" 
        Width="600"
        WindowStartupLocation="CenterScreen"
        ResizeMode="NoResize"
        Background="{StaticResource BackgroundBrush}">
    
    <Window.Resources>
        <ResourceDictionary>
            <ResourceDictionary.MergedDictionaries>
                <ui:ThemeResources />
                <ui:XamlControlsResources />
                <ResourceDictionary Source="/Resources/Styles/ModernStyles.xaml"/>
            </ResourceDictionary.MergedDictionaries>
            
            <converters:BoolToVisibilityConverter x:Key="BoolToVisibility"/>
        </ResourceDictionary>
    </Window.Resources>

    <Grid Margin="25">
        <!-- Optimized Background - Solid color -->
        <Grid.Background>
            <SolidColorBrush Color="{StaticResource BackgroundColor}"/>
        </Grid.Background>
        
        <Border Style="{StaticResource ModernCard}" Padding="30">
            <ScrollViewer VerticalScrollBarVisibility="Auto">
                <StackPanel>
                    <!-- Header -->
                    <TextBlock Text="Edit User Information" 
                              FontSize="28" 
                              FontWeight="Bold" 
                              Foreground="{StaticResource TextPrimaryBrush}"
                              Margin="0,0,0,5"
                              TextOptions.TextFormattingMode="Display"/>
                    <TextBlock Text="Update student or faculty member details" 
                              FontSize="14" 
                              Foreground="{StaticResource TextSecondaryBrush}"
                              Margin="0,0,0,25"/>

                    <!-- Photo Display -->
                    <Border CornerRadius="12" 
                           BorderBrush="#E5E7EB" 
                           BorderThickness="2" 
                           Width="130" 
                           Height="130" 
                           Margin="0,0,0,30"
                           HorizontalAlignment="Center">
                        <Image Source="{Binding User.PhotoPath}" 
                              Stretch="UniformToFill"/>
                    </Border>

                    <!-- Basic Information Section -->
                    <TextBlock Text="ðŸ“ Basic Information" 
                              Style="{StaticResource SectionHeader}"/>
                    
                    <Separator Background="#E5E7EB" Margin="0,0,0,15"/>

                    <!-- Name -->
                    <TextBlock Text="Full Name *" Style="{StaticResource FieldLabel}"/>
                    <TextBox Text="{Binding User.Name, UpdateSourceTrigger=PropertyChanged}" 
                            Style="{StaticResource ModernTextBox}"
                            Height="45"/>

                    <!-- Phone -->
                    <TextBlock Text="Phone Number *" Style="{StaticResource FieldLabel}"/>
                    <TextBox Text="{Binding User.Phone, UpdateSourceTrigger=PropertyChanged}" 
                            Style="{StaticResource ModernTextBox}"
                            Height="45"/>

                    <!-- Email -->
                    <TextBlock Text="Email (Optional)" Style="{StaticResource FieldLabel}"/>
                    <TextBox Text="{Binding User.Email, UpdateSourceTrigger=PropertyChanged}" 
                            Style="{StaticResource ModernTextBox}"
                            Height="45"/>

                    <!-- Department -->
                    <TextBlock Text="Department *" Style="{StaticResource FieldLabel}"/>
                    <ComboBox ItemsSource="{Binding Departments}" 
                             SelectedItem="{Binding User.Department}" 
                             Height="45"
                             Padding="12,0"
                             FontSize="14"
                             IsEditable="True"/>

                    <!-- User Type -->
                    <TextBlock Text="User Type *" Style="{StaticResource FieldLabel}"/>
                    <ComboBox ItemsSource="{Binding UserTypes}" 
                             SelectedItem="{Binding User.UserType}" 
                             Height="45"
                             Padding="12,0"
                             FontSize="14"/>

                    <!-- Faculty Information Section -->
                    <StackPanel Visibility="{Binding IsFaculty, Converter={StaticResource BoolToVisibility}}">
                        <TextBlock Text="ðŸ’¼ Faculty Information" 
                                  Style="{StaticResource SectionHeader}"/>
                        
                        <Separator Background="#E5E7EB" Margin="0,0,0,15"/>

                        <!-- Faculty Type -->
                        <TextBlock Text="Faculty Type *" Style="{StaticResource FieldLabel}"/>
                        <ComboBox ItemsSource="{Binding FacultyTypes}" 
                                 SelectedItem="{Binding User.FacultyType}" 
                                 Height="45"
                                 Padding="12,0"
                                 FontSize="14"/>

                        <!-- Monthly Regular Fields -->
                        <StackPanel Visibility="{Binding IsMonthlyRegular, Converter={StaticResource BoolToVisibility}}">
                            <TextBlock Text="Monthly Salary *" Style="{StaticResource FieldLabel}"/>
                            <TextBox Text="{Binding User.MonthlySalary, UpdateSourceTrigger=PropertyChanged, StringFormat=N2}" 
                                    Style="{StaticResource ModernTextBox}"
                                    Height="45"/>
                        </StackPanel>

                        <!-- Visiting Fixed Fields -->
                        <StackPanel Visibility="{Binding IsVisitingFixed, Converter={StaticResource BoolToVisibility}}">
                            <TextBlock Text="Fixed Salary (30 days) *" Style="{StaticResource FieldLabel}"/>
                            <TextBox Text="{Binding User.FixedSalary, UpdateSourceTrigger=PropertyChanged, StringFormat=N2}" 
                                    Style="{StaticResource ModernTextBox}"
                                    Height="45"/>
                        </StackPanel>

                        <!-- Visiting Per-Day Fields -->
                        <StackPanel Visibility="{Binding IsVisitingPerDay, Converter={StaticResource BoolToVisibility}}">
                            <TextBlock Text="Per-Day Rate *" Style="{StaticResource FieldLabel}"/>
                            <TextBox Text="{Binding User.PerDayRate, UpdateSourceTrigger=PropertyChanged, StringFormat=N2}" 
                                    Style="{StaticResource ModernTextBox}"
                                    Height="45"/>
                        </StackPanel>
                    </StackPanel>

                    <!-- Status Section -->
                    <TextBlock Text="âš™ Status" 
                              Style="{StaticResource SectionHeader}"/>
                    <Separator Background="#E5E7EB" Margin="0,0,0,15"/>
                    
                    <Border Background="#F9FAFB" 
                           CornerRadius="8" 
                           Padding="15"
                           BorderBrush="#E5E7EB"
                           BorderThickness="1">
                        <CheckBox Content="User is Active" 
                                 IsChecked="{Binding User.IsActive}" 
                                 FontSize="14"
                                 FontWeight="SemiBold"
                                 Foreground="{StaticResource TextPrimaryBrush}"/>
                    </Border>

                    <!-- Validation Error -->
                    <Border Background="#FEE2E2" 
                           CornerRadius="8"
                           Padding="15"
                           Margin="0,15,0,0"
                           Visibility="{Binding ValidationError, Converter={StaticResource BoolToVisibility}}">
                        <StackPanel Orientation="Horizontal">
                            <TextBlock Text="âš " 
                                      Foreground="#DC2626" 
                                      FontSize="18"
                                      Margin="0,0,10,0"/>
                            <TextBlock Text="{Binding ValidationError}" 
                                      Foreground="#DC2626"
                                      FontWeight="SemiBold"
                                      TextWrapping="Wrap"/>
                        </StackPanel>
                    </Border>

                    <!-- Action Buttons -->
                    <Grid Margin="0,30,0,0">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>
                        
                        <Button Grid.Column="0"
                               Content="ðŸ’¾ Save Changes" 
                               Command="{Binding SaveCommand}" 
                               Style="{StaticResource SuccessButton}"
                               Height="50"
                               Margin="0,0,8,0"/>
                        <Button Grid.Column="1"
                               Content="âœ– Cancel" 
                               Command="{Binding CancelCommand}" 
                               Style="{StaticResource OutlineButton}"
                               Height="50"
                               Margin="8,0,0,0"/>
                    </Grid>

                    <!-- Last Modified Info -->
                    <Border Background="#F3F4F6" 
                           CornerRadius="8" 
                           Padding="12"
                           Margin="0,20,0,0">
                        <TextBlock Text="{Binding LastModifiedInfo}" 
                                  Foreground="{StaticResource TextSecondaryBrush}"
                                  FontSize="12" 
                                  HorizontalAlignment="Center"
                                  TextWrapping="Wrap"/>
                    </Border>
                </StackPanel>
            </ScrollViewer>
        </Border>
    </Grid>
</Window>