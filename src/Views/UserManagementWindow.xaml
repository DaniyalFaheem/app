<Window x:Class="FaceRecognitionAttendance.Views.UserManagementWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:ui="http://schemas.modernwpf.com/2019"
        xmlns:converters="clr-namespace:FaceRecognitionAttendance.Converters"
        ui:WindowHelper.UseModernWindowStyle="True"
        Title="User Management" 
        Height="700" 
        Width="1200"
        WindowStartupLocation="CenterScreen">
    
    <Window.Resources>
        <converters:BoolToVisibilityConverter x:Key="BoolToVisibility"/>
        <converters:BoolToColorConverter x:Key="BoolToColor"/>
    </Window.Resources>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Header and Search Bar -->
        <Grid Grid.Row="0" Margin="20,20,20,10">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>

            <StackPanel Grid.Column="0" Orientation="Horizontal">
                <TextBlock Text="User Management" 
                          FontSize="24" 
                          FontWeight="Bold" 
                          VerticalAlignment="Center"/>
                
                <TextBlock Text="{Binding TotalUsers, StringFormat=' ({0} users)'}" 
                          FontSize="16" 
                          Foreground="Gray"
                          VerticalAlignment="Center"
                          Margin="10,0,0,0"/>
            </StackPanel>

            <Button Grid.Column="1" 
                   Content="Refresh" 
                   Command="{Binding RefreshCommand}"
                   Width="100"
                   Height="35"/>
        </Grid>

        <!-- Search and Filter Controls -->
        <Grid Grid.Row="0" Margin="20,60,20,10">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="200"/>
            </Grid.ColumnDefinitions>

            <TextBox Grid.Column="0" 
                    Text="{Binding SearchText, UpdateSourceTrigger=PropertyChanged}" 
                    ui:ControlHelper.PlaceholderText="Search by name, ID, phone, or department..."
                    Height="35"
                    Padding="10"
                    FontSize="14"
                    Margin="0,0,10,0"/>

            <Button Grid.Column="1" 
                   Content="Search" 
                   Command="{Binding SearchCommand}"
                   Width="100"
                   Height="35"
                   Margin="0,0,10,0"
                   Style="{StaticResource AccentButtonStyle}"/>

            <ComboBox Grid.Column="2" 
                     SelectedItem="{Binding FilterUserType}"
                     Height="35">
                <ComboBoxItem Content="All Users"/>
                <ComboBoxItem Content="Students Only"/>
                <ComboBoxItem Content="Faculty Only"/>
            </ComboBox>
        </Grid>

        <!-- Users DataGrid -->
        <DataGrid Grid.Row="1" 
                 ItemsSource="{Binding Users}" 
                 SelectedItem="{Binding SelectedUser}"
                 AutoGenerateColumns="False" 
                 IsReadOnly="True"
                 CanUserSortColumns="True" 
                 CanUserResizeColumns="True"
                 SelectionMode="Single"
                 Margin="20,10,20,10"
                 GridLinesVisibility="Horizontal"
                 AlternatingRowBackground="#F5F5F5">
            
            <DataGrid.Columns>
                <DataGridTextColumn Header="ID" Binding="{Binding Id}" Width="60"/>
                
                <DataGridTemplateColumn Header="Photo" Width="70">
                    <DataGridTemplateColumn.CellTemplate>
                        <DataTemplate>
                            <Border Width="50" Height="50" 
                                   BorderBrush="Gray" 
                                   BorderThickness="1"
                                   Margin="5">
                                <Image Source="{Binding PhotoPath}" 
                                      Stretch="UniformToFill"/>
                            </Border>
                        </DataTemplate>
                    </DataGridTemplateColumn.CellTemplate>
                </DataGridTemplateColumn>
                
                <DataGridTextColumn Header="Name" Binding="{Binding Name}" Width="*" MinWidth="150"/>
                <DataGridTextColumn Header="Type" Binding="{Binding UserType}" Width="80"/>
                <DataGridTextColumn Header="Department" Binding="{Binding Department}" Width="150"/>
                <DataGridTextColumn Header="Phone" Binding="{Binding Phone}" Width="120"/>
                <DataGridTextColumn Header="Registered" Binding="{Binding RegistrationDate, StringFormat=yyyy-MM-dd}" Width="100"/>
                
                <DataGridTemplateColumn Header="Status" Width="80">
                    <DataGridTemplateColumn.CellTemplate>
                        <DataTemplate>
                            <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                                <Ellipse Width="12" Height="12" 
                                        Fill="{Binding IsActive, Converter={StaticResource BoolToColor}}"
                                        Margin="0,0,5,0"/>
                                <TextBlock Text="{Binding IsActive, Converter={StaticResource BoolToStatusText}}"
                                          VerticalAlignment="Center"/>
                            </StackPanel>
                        </DataTemplate>
                    </DataGridTemplateColumn.CellTemplate>
                </DataGridTemplateColumn>
            </DataGrid.Columns>
        </DataGrid>

        <!-- Loading Indicator -->
        <Grid Grid.Row="1" 
             Visibility="{Binding IsLoading, Converter={StaticResource BoolToVisibility}}"
             Background="#80FFFFFF">
            <StackPanel HorizontalAlignment="Center" VerticalAlignment="Center">
                <ProgressBar IsIndeterminate="True" Width="200" Height="4"/>
                <TextBlock Text="Loading users..." 
                          FontSize="14" 
                          Margin="0,10,0,0"
                          HorizontalAlignment="Center"/>
            </StackPanel>
        </Grid>

        <!-- Action Buttons -->
        <Grid Grid.Row="2" Margin="20,10,20,10">
            <StackPanel Orientation="Horizontal" HorizontalAlignment="Right">
                <Button Content="Edit User" 
                       Command="{Binding EditUserCommand}" 
                       Width="130" 
                       Height="40"
                       Margin="0,0,10,0"
                       Style="{StaticResource AccentButtonStyle}">
                    <Button.ToolTip>
                        <ToolTip Content="Edit selected user information"/>
                    </Button.ToolTip>
                </Button>
                
                <Button Content="Delete User" 
                       Command="{Binding DeleteUserCommand}" 
                       Width="130" 
                       Height="40"
                       Margin="0,0,10,0"
                       Background="#DC3545"
                       Foreground="White">
                    <Button.ToolTip>
                        <ToolTip Content="Delete selected user permanently"/>
                    </Button.ToolTip>
                </Button>
                
                <Button Content="View Details" 
                       Command="{Binding ViewDetailsCommand}" 
                       Width="130" 
                       Height="40">
                    <Button.ToolTip>
                        <ToolTip Content="View complete user details"/>
                    </Button.ToolTip>
                </Button>
            </StackPanel>
        </Grid>

        <!-- Status Bar -->
        <Border Grid.Row="3" 
               Background="#F0F0F0" 
               BorderBrush="#CCCCCC" 
               BorderThickness="0,1,0,0"
               Padding="20,10">
            <StackPanel Orientation="Horizontal">
                <TextBlock Text="Selected: " FontWeight="SemiBold"/>
                <TextBlock Text="{Binding SelectedUser.Name, FallbackValue='None'}"/>
                <TextBlock Text=" | " Margin="10,0"/>
                <TextBlock Text="Double-click row to view details" 
                          Foreground="Gray" 
                          FontStyle="Italic"/>
            </StackPanel>
        </Border>
    </Grid>
</Window>