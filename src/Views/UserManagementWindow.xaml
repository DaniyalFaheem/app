<Window x:Class="FaceRecognitionAttendance.Views.UserManagementWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:ui="http://schemas.modernwpf.com/2019"
        xmlns:converters="clr-namespace:FaceRecognitionAttendance.Converters"
        ui:WindowHelper.UseModernWindowStyle="True"
        Title="User Management - Face Recognition Attendance" 
        Height="700" 
        Width="1200"
        WindowStartupLocation="CenterScreen"
        Background="{StaticResource BackgroundBrush}">
    
    <Window.Resources>
        <ResourceDictionary>
            <ResourceDictionary.MergedDictionaries>
                <ui:ThemeResources />
                <ui:XamlControlsResources />
                <ResourceDictionary Source="/Resources/Styles/ModernStyles.xaml"/>
            </ResourceDictionary.MergedDictionaries>
            
            <converters:BoolToVisibilityConverter x:Key="BoolToVisibility"/>
            <converters:BoolToColorConverter x:Key="BoolToColor"/>
        </ResourceDictionary>
    </Window.Resources>

    <Grid Margin="20">
        <!-- Optimized Background - No image for better performance -->
        <Grid.Background>
            <SolidColorBrush Color="{StaticResource BackgroundColor}"/>
        </Grid.Background>
        
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Modern Header with Card -->
        <Border Grid.Row="0" 
               Style="{StaticResource ModernCard}" 
               Margin="0,0,0,20"
               Padding="25">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>

                <!-- Title Row -->
                <Grid Grid.Row="0" Margin="0,0,0,20">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>

                    <StackPanel Grid.Column="0">
                        <TextBlock Text="User Management" 
                                  FontSize="28" 
                                  FontWeight="Bold" 
                                  Foreground="{StaticResource TextPrimaryBrush}"
                                  TextOptions.TextFormattingMode="Display"/>
                        <StackPanel Orientation="Horizontal" Margin="0,5,0,0">
                            <TextBlock Text="{Binding TotalUsers, StringFormat='{}{0} Total Users'}" 
                                      FontSize="14" 
                                      Foreground="{StaticResource TextSecondaryBrush}"/>
                            <TextBlock Text=" â€¢ " 
                                      FontSize="14" 
                                      Foreground="{StaticResource TextSecondaryBrush}"
                                      Margin="5,0"/>
                            <TextBlock Text="Manage student and faculty profiles" 
                                      FontSize="14" 
                                      Foreground="{StaticResource TextSecondaryBrush}"/>
                        </StackPanel>
                    </StackPanel>

                    <Button Grid.Column="1" 
                           Content="â†» Refresh" 
                           Command="{Binding RefreshCommand}"
                           Style="{StaticResource OutlineButton}"
                           Height="40"
                           Padding="20,0"
                           VerticalAlignment="Top"/>
                </Grid>

                <!-- Search and Filter Row -->
                <Grid Grid.Row="1">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="220"/>
                    </Grid.ColumnDefinitions>

                    <TextBox Grid.Column="0" 
                            Text="{Binding SearchText, UpdateSourceTrigger=PropertyChanged}" 
                            ui:ControlHelper.PlaceholderText="ðŸ” Search by name, ID, phone, or department..."
                            Style="{StaticResource ModernTextBox}"
                            Height="45"
                            Margin="0,0,15,0"/>

                    <Button Grid.Column="1" 
                           Content="Search" 
                           Command="{Binding SearchCommand}"
                           Style="{StaticResource PrimaryButton}"
                           Height="45"
                           Padding="25,0"
                           Margin="0,0,15,0"/>

                    <ComboBox Grid.Column="2" 
                             SelectedItem="{Binding FilterUserType}"
                             Style="{StaticResource ModernComboBox}"
                             Height="45"
                             Padding="12,0"
                             FontSize="14">
                        <ComboBoxItem Content="ðŸ“‹ All Users"/>
                        <ComboBoxItem Content="ðŸŽ“ Students Only"/>
                        <ComboBoxItem Content="ðŸ‘¨â€ðŸ« Faculty Only"/>
                    </ComboBox>
                </Grid>
            </Grid>
        </Border>

        <!-- Modern DataGrid Card -->
        <Border Grid.Row="1" 
               Style="{StaticResource ModernCard}"
               Padding="0"
               Margin="0,0,0,20">
            <DataGrid ItemsSource="{Binding Users}" 
                     SelectedItem="{Binding SelectedUser}"
                     Style="{StaticResource ModernDataGrid}"
                     AutoGenerateColumns="False" 
                     IsReadOnly="True"
                     CanUserSortColumns="True" 
                     CanUserResizeColumns="True"
                     SelectionMode="Single"
                     GridLinesVisibility="Horizontal"
                     AlternatingRowBackground="#F9FAFB"
                     RowHeight="60"
                     HeadersVisibility="Column"
                     BorderThickness="0"
                     Background="White">
            
                <DataGrid.Columns>
                    <DataGridTextColumn Header="ID" Binding="{Binding Id}" Width="60">
                        <DataGridTextColumn.ElementStyle>
                            <Style TargetType="TextBlock">
                                <Setter Property="FontWeight" Value="SemiBold"/>
                                <Setter Property="Foreground" Value="{StaticResource TextSecondaryBrush}"/>
                                <Setter Property="VerticalAlignment" Value="Center"/>
                            </Style>
                        </DataGridTextColumn.ElementStyle>
                    </DataGridTextColumn>
                    
                    <DataGridTemplateColumn Header="Photo" Width="70">
                        <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate>
                                <Border Width="45" Height="45" 
                                       CornerRadius="8"
                                       Margin="5"
                                       BorderBrush="#E5E7EB"
                                       BorderThickness="1">
                                    <Image Source="{Binding PhotoPath}" 
                                          Stretch="UniformToFill"/>
                                </Border>
                            </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                    </DataGridTemplateColumn>
                    
                    <DataGridTextColumn Header="Name" Binding="{Binding Name}" Width="*" MinWidth="150">
                        <DataGridTextColumn.ElementStyle>
                            <Style TargetType="TextBlock">
                                <Setter Property="FontWeight" Value="SemiBold"/>
                                <Setter Property="Foreground" Value="{StaticResource TextPrimaryBrush}"/>
                                <Setter Property="VerticalAlignment" Value="Center"/>
                            </Style>
                        </DataGridTextColumn.ElementStyle>
                    </DataGridTextColumn>
                    
                    <DataGridTextColumn Header="Type" Binding="{Binding UserType}" Width="90">
                        <DataGridTextColumn.ElementStyle>
                            <Style TargetType="TextBlock">
                                <Setter Property="VerticalAlignment" Value="Center"/>
                            </Style>
                        </DataGridTextColumn.ElementStyle>
                    </DataGridTextColumn>
                    
                    <DataGridTextColumn Header="Department" Binding="{Binding Department}" Width="150">
                        <DataGridTextColumn.ElementStyle>
                            <Style TargetType="TextBlock">
                                <Setter Property="VerticalAlignment" Value="Center"/>
                            </Style>
                        </DataGridTextColumn.ElementStyle>
                    </DataGridTextColumn>
                    
                    <DataGridTextColumn Header="Phone" Binding="{Binding Phone}" Width="130">
                        <DataGridTextColumn.ElementStyle>
                            <Style TargetType="TextBlock">
                                <Setter Property="FontFamily" Value="Consolas"/>
                                <Setter Property="VerticalAlignment" Value="Center"/>
                            </Style>
                        </DataGridTextColumn.ElementStyle>
                    </DataGridTextColumn>
                    
                    <DataGridTextColumn Header="Registered" Binding="{Binding RegistrationDate, StringFormat=yyyy-MM-dd}" Width="110">
                        <DataGridTextColumn.ElementStyle>
                            <Style TargetType="TextBlock">
                                <Setter Property="Foreground" Value="{StaticResource TextSecondaryBrush}"/>
                                <Setter Property="VerticalAlignment" Value="Center"/>
                            </Style>
                        </DataGridTextColumn.ElementStyle>
                    </DataGridTextColumn>
                    
                    <DataGridTemplateColumn Header="Status" Width="100">
                        <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate>
                                <Border CornerRadius="12" 
                                       Padding="10,4" 
                                       HorizontalAlignment="Center"
                                       VerticalAlignment="Center">
                                    <Border.Style>
                                        <Style TargetType="Border">
                                            <Style.Triggers>
                                                <DataTrigger Binding="{Binding IsActive}" Value="True">
                                                    <Setter Property="Background" Value="#D1FAE5"/>
                                                </DataTrigger>
                                                <DataTrigger Binding="{Binding IsActive}" Value="False">
                                                    <Setter Property="Background" Value="#FEE2E2"/>
                                                </DataTrigger>
                                            </Style.Triggers>
                                        </Style>
                                    </Border.Style>
                                    <TextBlock VerticalAlignment="Center" FontSize="12" FontWeight="SemiBold">
                                        <TextBlock.Style>
                                            <Style TargetType="TextBlock">
                                                <Style.Triggers>
                                                    <DataTrigger Binding="{Binding IsActive}" Value="True">
                                                        <Setter Property="Text" Value="â— Active"/>
                                                        <Setter Property="Foreground" Value="#059669"/>
                                                    </DataTrigger>
                                                    <DataTrigger Binding="{Binding IsActive}" Value="False">
                                                        <Setter Property="Text" Value="â— Inactive"/>
                                                        <Setter Property="Foreground" Value="#DC2626"/>
                                                    </DataTrigger>
                                                </Style.Triggers>
                                            </Style>
                                        </TextBlock.Style>
                                    </TextBlock>
                                </Border>
                            </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                    </DataGridTemplateColumn>
                </DataGrid.Columns>
            </DataGrid>
        </Border>

        <!-- Loading Indicator Overlay -->
        <Border Grid.Row="1" 
               Visibility="{Binding IsLoading, Converter={StaticResource BoolToVisibility}}"
               Background="#F0FFFFFF"
               CornerRadius="12">
            <StackPanel HorizontalAlignment="Center" VerticalAlignment="Center">
                <ui:ProgressRing IsActive="{Binding IsLoading}" 
                                Width="50" 
                                Height="50"/>
                <TextBlock Text="Loading users..." 
                          FontSize="15" 
                          FontWeight="SemiBold"
                          Foreground="{StaticResource TextPrimaryBrush}"
                          Margin="0,15,0,0"
                          HorizontalAlignment="Center"/>
            </StackPanel>
        </Border>

        <!-- Modern Action Buttons -->
        <Border Grid.Row="2" 
               Style="{StaticResource ModernCard}"
               Padding="25">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <!-- Selection Info -->
                <StackPanel Grid.Column="0" VerticalAlignment="Center">
                    <TextBlock FontSize="14" Foreground="{StaticResource TextSecondaryBrush}">
                        <Run Text="Selected:"/>
                        <Run Text="{Binding SelectedUser.Name, FallbackValue='None'}" 
                             FontWeight="SemiBold" 
                             Foreground="{StaticResource TextPrimaryBrush}"/>
                    </TextBlock>
                    <TextBlock Text="ðŸ’¡ Double-click a row to view full details" 
                              FontSize="12" 
                              Foreground="{StaticResource TextSecondaryBrush}"
                              Margin="0,5,0,0"/>
                </StackPanel>

                <!-- Action Buttons -->
                <StackPanel Grid.Column="1" Orientation="Horizontal">
                    <Button Content="âœ Edit User" 
                           Command="{Binding EditUserCommand}" 
                           Style="{StaticResource PrimaryButton}"
                           Height="45"
                           Padding="20,0"
                           Margin="0,0,12,0">
                        <Button.ToolTip>
                            <ToolTip Content="Edit selected user information"/>
                        </Button.ToolTip>
                    </Button>
                    
                    <Button Content="ðŸ—‘ Delete" 
                           Command="{Binding DeleteUserCommand}" 
                           Style="{StaticResource DangerButton}"
                           Height="45"
                           Padding="20,0"
                           Margin="0,0,12,0">
                        <Button.ToolTip>
                            <ToolTip Content="Delete selected user permanently"/>
                        </Button.ToolTip>
                    </Button>
                    
                    <Button Content="ðŸ‘ Details" 
                           Command="{Binding ViewDetailsCommand}" 
                           Style="{StaticResource OutlineButton}"
                           Height="45"
                           Padding="20,0">
                        <Button.ToolTip>
                            <ToolTip Content="View complete user details"/>
                        </Button.ToolTip>
                    </Button>
                </StackPanel>
            </Grid>
        </Border>
    </Grid>
</Window>